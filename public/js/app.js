"use strict";$(document).ready(function(){app=new Vue({el:"#app",components:{settings:{template:'\n                    <div>\n                    <h2 class="title is-3 has-text-centered">Установки системы</h2>\n                    <div class="tabs is-boxed">\n                    \n                      <ul>\n                        <li  v-bind:class="{\'is-active\':(tabActiveIndex==0)}" v-on:click="tabSelect(0)">\n                          <a>\n                            <span class="icon is-small"><i class="fa fa-bars"></i></span>\n                            <span>Рабочие таблицы</span>\n                          </a>\n                        </li>\n                        <li v-bind:class="{\'is-active\':(tabActiveIndex==1)}"  v-on:click="tabSelect(1)">\n                          <a>\n                            <span class="icon is-small"><i class="fa fa-database"></i></span>\n                            <span>Базы данных</span>\n                          </a>\n                        </li>\n                        <li v-bind:class="{\'is-active\':(tabActiveIndex==2)}"  v-on:click="tabSelect(2)">\n                          <a>\n                            <span class="icon is-small"><i class="fa fa-picture-o"></i></span>\n                            <span>Цвета</span>\n                          </a>\n                        </li>\n        \n                      </ul>\n                    </div>\n                    \x3c!--B:Databases--\x3e\n                    <div class="columns" v-show="tabActiveIndex==1">\n                          <div class="field" style="background-color: #f5f7fa;padding:10px;">                   \n                              <label class="radio">\n                                <input type="radio" name="bases" checked v-on:click="selectDatabase(0)">\n                                Documents\n                              </label>\n                              <label class="radio">\n                                <input type="radio" name="bases" v-on:click="selectDatabase(1)">\n                                Sbcnts\n                              </label>                   \n                          </div>\n                      </div>\n                      \x3c!--E:Databases--\x3e\n                    </div>\n                    ',data:function(){return{tabActiveIndex:0}},methods:{tabSelect:function(e){console.log(e),this.tabActiveIndex=e}}}},data:{menu:[{label:"Основной график",isActive:!0},{label:"Источники данных",isActive:!1},{label:"Основные показатели",isActive:!1},{label:"Пользователи",isActive:!1},{label:"Установки системы",isActive:!1}],menuActiveIndex:0,data_bases:[{name:"documents"},{name:"Sbcnts"}],cur_base_name:"documents",data_source:[{id:0,name:"заявкапокупателя_шапка",fields:[{name:"IDDOC",type:"varchar(9)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"Склад",type:"varchar(100)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"Клиент",type:"varchar(100)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"Получатель",type:"varchar(100)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"ДатаОтгрузки",type:"date",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"ДатаПлатежа",type:"date",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"СуммаПлатежа",type:"decimal(17,2)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""}],isOpen:!0},{id:1,name:"заявкапокупателя",fields:[{name:"IDDOC",type:"varchar(9)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"Товар",type:"varchar(100)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"Количество",type:"decimal(13,6)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"Цена",type:" decimal(17,2)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"Сумма",type:" decimal(17,2)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"ВесФакт",type:" decimal(17,2)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"ВесВозвр",type:" decimal(17,2)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"СуммаНДС",type:" decimal(15,2)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""}],isOpen:!1},{id:2,name:"валюта",fields:[{name:"ID",type:"varchar(9)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"CODE",type:"varchar(3)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"DESCR",type:"varchar(9)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"ISMARK",type:"varchar(9)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"VERSTAMP",type:"varchar(9)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""}],isOpen:!1},{id:3,name:"контрагенты",fields:[{name:"ID",type:"varchar(9)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"CODE",type:"varchar(80)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"DESCR",type:"varchar(80)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"ISMARK",type:"varchar(1)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"VERSTAMP",type:"varchar(9)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"ISFOLDER",type:"int(11)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""},{name:"PARENTID",type:"varchar(9)",isAxisSelect:!1,axisSelectedName:"",filterSelectedName:"",groupSelectedName:""}],isOpen:!1}],selectedTableId:0,cur_ds_index:0,selectedFields:{axis_x:[],axis_y:[],filter:[],group:[]},filter_field:"поле",axis_x_detail:[2012,2013,2014,2015,2016,2017],axis_x_select:"year",month_list:[{name:"Январь",name_short:"Янв"},{name:"Февраль",name_short:"Фев"},{name:"Март",name_short:"Март"},{name:"Апрель",name_short:"Апр"},{name:"Июнь",name_short:"Июнь"},{name:"Июль",name_short:"Июль"},{name:"Август",name_short:"Авг"},{name:"Сентябрь",name_short:"Сент"},{name:"Октябрь",name_short:"Окт"},{name:"Ноябрь",name_short:"Нояб"},{name:"Декабрь",name_short:"Дек"}],year_list:[2012,2013,2014,2015,2016,2017],main_chart_el:"#main_chart",main_chart_obj:{},main_chart_options:{credits:{enabled:!1},chart:{renderTo:"main_chart",type:"spline"},title:{text:"График заявок покупателей"},xAxis:{categories:["Январь","Февраль","Март","Апрель","Май"]},yAxis:{title:{text:"Сумма"},labels:{format:"{value} руб"}},series:[{data:[10500,206500,2345,400240,55034]}]},client_type:0,goods_type:0,client_selected:"A",clients_list:[{text:"Ваш продукт Компания (Ваш продукт, Торгсервис)",value:"A"},{text:'Шоколадница (Глазурь, РайсТорг, Концерн < Шоколадница >")',value:"B"},{text:"КузбассСнаб  (Мастер Кейк)",value:"C"}],goods_selected:"A",goods_list:[{text:"Какао порошок алкализованный 10-12% жирность",value:"A"},{text:"Вафельная крошка",value:"B"},{text:"Жиры различных наименований (Эколад, Эконд, пр.)",value:"C"}],group_list:[{text:"год",value:"год"},{text:"вид товара",value:"вид товара"}],filter_cond_operations:[{name:" = ",value:"="},{name:" <> ",value:"="},{name:" * ",value:"="},{name:" / ",value:"="}],filter_field_value:0,filter_group:[{name:"field-1"},{name:"field-2"}]},methods:{menuActive:function(e){this.menuActiveIndex=e;for(var a=0;a<this.menu.length;a++)this.menu[a].isActive=a==e;console.log(e)},axisXChange:function(e){if(console.log(this.axis_x_select),this.axis_x_detail=[],"month"==this.axis_x_select){for(var a=0;a<this.month_list.length;a++)this.axis_x_detail.push(this.month_list[a].name);this.main_chart_obj.xAxis[0].categories=this.axis_x_detail}if("year"==this.axis_x_select)for(var a=0;a<this.year_list.length;a++)this.axis_x_detail.push(this.year_list[a])},sourceFieldClick:function(e){this.data_source[e].isOpen?this.data_source[e].isOpen=!1:this.data_source[e].isOpen=!0},selectFieldAxis:function(e,a,t){},selectFilterField:function(e,a){this.filter_field=this.data_source[e].fields[a].name},setCurDsIndex:function(){for(var e=0;e<this.data_source.length;e++)if(this.data_source[e].id==this.selectedTableId)return void(this.cur_ds_index=e)},selectDatabase:function(e){console.log(e)},selectTableChange:function(e){console.log($("#"+e).val()),console.log(this.selectedTableId),this.setCurDsIndex()},btnLoadClick:function(){alert("Загрузка данных...")},initMainChart:function(e){app.$data.main_chart_obj=new Highcharts.Chart(e)},changeMainGraphType:function(e){this.main_chart_obj.options.chart.type=e,this.main_chart_obj.series[0].update({type:e})},clientTypeSelect:function(){console.log(this.client_type)},goodsTypeSelect:function(){console.log(this.goods_type)},clearGroupFields:function(){for(var e=0;e<this.data_source.length;e++)for(var a=this.data_source[e].fields,t=0;t<a.length;t++)a[t].groupSelectedName="";this.selectedFields.group=[]},clearFilterFields:function(e){for(var a=0;a<this.data_source.length;a++)for(var t=this.data_source[a].fields,i=0;i<t.length;i++)t[i].filterSelectedName="";this.selectedFields.filter=[],"all"==e&&(this.filter_field="",this.filter_field_value=0)},clearAxisFields:function(){for(var e=0;e<this.data_source.length;e++)for(var a=this.data_source[e].fields,t=0;t<a.length;t++)a[t].isAxisSelect=!1,a[t].axisSelectedName="";this.selectedFields.axis_x=[],this.selectedFields.axis_y=[],this.clearFilterFields("all"),this.clearGroupFields()},allowDrop:function(e){e.preventDefault()},fieldDrag:function(e){console.log("Drag is:",e),e.dataTransfer.setData("text",e.target.id)},fieldDrop:function(e){e.preventDefault();var a=e.dataTransfer.getData("text");console.log("fieldDrop data:",a),console.log("ev.target.id:",e.target.id);var t=a.split("_")[1],i=a.split("_")[2],s={base_name:this.cur_base_name,table_name:this.data_source[this.selectedTableId].name,field_name:this.data_source[t].fields[i].name};this.data_source[t].fields[i].isAxisSelect=!0,"drop_x"==e.target.id&&(this.data_source[t].fields[i].axisSelectedName="x",this.selectedFields.axis_x.push(s)),"drop_y"==e.target.id&&(this.data_source[t].fields[i].axisSelectedName="y",this.selectedFields.axis_y.push(s))},fieldFilterDrop:function(e){e.preventDefault();var a=e.dataTransfer.getData("text"),t=a.split("_")[1],i=a.split("_")[2],s={base_name:this.cur_base_name,table_name:this.data_source[this.selectedTableId].name,field_name:this.data_source[t].fields[i].name};this.clearFilterFields("field"),this.data_source[t].fields[i].filterSelectedName=this.data_source[t].fields[i].name,this.selectFilterField(t,i),this.selectedFields.filter.push(s)},fieldGroupDrop:function(e){e.preventDefault();var a=e.dataTransfer.getData("text"),t=a.split("_")[1],i=a.split("_")[2],s={base_name:this.cur_base_name,table_name:this.data_source[this.selectedTableId].name,field_name:this.data_source[t].fields[i].name};this.data_source[t].fields[i].groupSelectedName=this.data_source[t].fields[i].name,this.selectedFields.group.push(s)}}}),app.initMainChart(app.$data.main_chart_options)});